<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Intelligence platform simple web page for basic intelligence">
  <meta name="author" content="">
  <link rel="icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAACA0lEQVR4Ae3VAYQiURjA8cNgEMIiDMJicQiLMDgWh0UIixAOh8VgsTgMQoBwCLAIIYTFASCEMDiEEMIghMUifPfHw+fx6s2YHHf75wcY9Z733vfpf+mjFgaYY4WtscAMz7jGRQuRYAfxtEYfldfBBlJShhiVNIBY9nhBF200jRg9TPEGUY74htIFmEGUHI8IcK4QKQ4QZYhSDSHKK+ooWoQlRCm8Uw8QZYQAZQut3T4iLvJxDjHmqKLQ2qkMXqUQY4saqiqyzlQfJwvPfPCEDGM04eozpliif2LBa5zsDmJsoGtDlDFc/bLOS2QtWj8J13A2PnE9E4jyG64OEKUL3RRiPMPZCmLE0DVwhBhPcPXTekRD6HoQYwZnO4gRwa6BBG2c6yu+ow67GGIs4EyUS9a0bvJf/0MRxNjBWQ4xGrhU+sYu4SyDGLe4VF3fSfACMVLng1Zcz/d37DonZk0dO0hBS+gC7CFGC85qeIcY99DFeIN4ynED3aPXgVaNrNc4gK7luVNrNKGrWxcnwdnqOJyZWSES5BDLDj8QQhfg1ZqVAbxKIJ4ruUKML7jx2nmgg0JNIMoYAYpWwxyipChciAXsCX8P3/rYQpQpShdiArFkSHFrvegRYgyxgVgGqKQEB0hJOR5QaVcY4R3i6YAUIS5WDR1MkGFvXfkVxrhDiI/+7f4AfdpSa7k2LiwAAAAASUVORK5CYII=">

  <title>Intelligence - Plates</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">

  <!-- Morris css -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">

  <!-- App own theme -->
  <!--suppress HtmlUnknownTarget -->
  <link rel="stylesheet" href="style.css">

</head>

<body>


<!-- Generic image view modal -->
<div class="modal fade bd-example-modal-lg" id="generic_image_modal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="generic_modal_title">...</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="generic_modal_description" class="text-muted">
        </p>
        <img id="generic_modal_image" class="card-img-right"
             style="width: 100%; height: 100%;"
             alt="Generic modal image">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<!-- sticky-top -->
<nav class="navbar navbar-dark sticky-top navbar-expand-lg bg-dark">
  <a class="navbar-brand col-sm-3 col-md-2 mr-0"
     style="font-family: 'Playfair Display', Georgia, 'Times New Roman', serif; font-size: 1.5rem;">
    <img
      src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAACHklEQVR4Ae3WAWTjUBjA8UNRFMVQFMUwHIahCI7hMBTFUBTDYQiG4RAUBRSHAIaiKIrhAFAURVAURREERVAMRe+PfTzP+faSJsy2Pz9M0rcvSdPk26foq+PxeIkBZlhi+2qOKR5xXvYQVfiI4doa/TKG6WCDvEXwihpmALsdntBFG61XHnqYYA+zA+5OGaSCKcwS3KPieIkDpDAb5h1oCLNn1HOs08QCZndZF7mF2QiVE2+IqXX5vCwfTiDNCrxLF5Ai1w8GkLaoFXi3NpFC6r99FMoH+PsBEUK0lHW+Y4IF+soBr98a6BrSxtrWhlmorPMX0gFN66D3kM61gUJIQ2ubD7OVsk4Ks661fQLpURtoCcmztjVwgPSgrPMH0g5Va3sP0lQbKIYkp9keykfb4Qv8E79Q/882D9JcW4SISn5QtyBt38NATUixtmMCqVHiQG1IC23HCNJViQN1Ic20HZ8gBcoPWtZ6+v/RX8SkyNpWR4ysLezXGuwgXWoD1fAC6ca+XbGHawkurDXuIcUu13cEaYWK/YLveKbWaNlnGQkk32WgOlJIofLCn8Auxm9U7UuFZ0gb/R1Lf275yr5n8PADFw5nXupkvTXHMAv1I1K/lzOYBXnf8OYwW+Emwxp9bGE2OfW1cwy7CAGu0LAeCR6G2MBuUNQvq48UeUtwW/TP/RlGeIFrKQJUy3xS19DBGBF2kGIsEeJaBvnqQ/cPDxGlXpRi3oIAAAAASUVORK5CYII="
      width="36" height="36" class="d-inline-block align-top" alt="">
    Intelligence</a>
  <div class="collapse navbar-collapse">
    <div class="navbar-nav">
      <a class="nav-item nav-link" id="homeBtn" style="cursor: pointer;">Home</a>
      <a class="nav-item nav-link" id="wallBtn" style="cursor: pointer;">Wall</a>
      <a class="nav-item nav-link active" style="cursor: pointer;">Plates <span class="sr-only">(current)</span></a>
      <a class="nav-item nav-link disabled" style="cursor: pointer;">Person lookup</a>
    </div>
  </div>
  <form class="form-inline my-2 my-lg-0">
  </form>
</nav>

<main role="main" class="container">

  <div class="col-md-12 mt-2">

    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span class="input-group-text" id="basic-addon1">Day's between</span>
      </div>
      <input id="selected_day_field_start" type="date" class="form-control" placeholder="Change day"
             aria-label="Day change">
      <input id="selected_day_field_end" type="date" class="form-control" placeholder="Change day"
             aria-label="Day change">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" id="load_day_btn">Load</button>
      </div>
    </div>

    <div class="card flex-md-row mb-4 box-shadow h-md-250"
         style="height: 100%;">
      <div class="card-body d-flex flex-column align-items-center">
        <strong class="d-inline-block mb-2 text-primary">Vehicles | License plates</strong>
        <div id="licence_plate_flex_viewer" class="d-flex flex-wrap mt-2 mb-2">
        </div>
      </div>
    </div>

  </div>

</main>

<footer class="intelligence-footer">
  <p>Intelligence <a href="https://github.com/norkator/Open-Intelligence">Github</a>.</p>
  <p>
    <a href="#">Back to top</a>
  </p>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->

<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

<!-- Morris chart -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"
        integrity="sha256-0rg2VtfJo3VUij/UY9X0HJP7NET6tgAY98aMOfwP0P8=" crossorigin="anonymous"></script>

<!-- Adds zooming effect -->
<script src="https://cdn.jsdelivr.net/npm/wheelzoom@4.0.1/wheelzoom.js"
        integrity="sha256-fhru0y6L8Knyrjj57vB7/npV5IUyq6Tvo8g0qoceVwQ=" crossorigin="anonymous"></script>

<script>
  $(document).ready(function () {

    // Api url
    const apiUrl = String(window.location.href).replace('plates.html', '');

    $('#homeBtn').click(() => {
      document.location.href = apiUrl;
    });
    $('#wallBtn').click(() => {
      document.location.href = apiUrl + "wall.html";
    });
    $('#camerasBtn').click(() => {
      document.location.href = apiUrl + "cameras.html";
    });

    const generic_image_modal = $('#generic_image_modal');
    const generic_modal_title = $('#generic_modal_title');
    const generic_modal_description = $('#generic_modal_description');
    const generic_modal_image = $('#generic_modal_image');

    const selected_day_field_start = $('#selected_day_field_start');
    selected_day_field_start.val( new Date(new Date().setDate(new Date().getDate() - 7)).toISOString().substr(0, 10) );
    const selected_day_field_end = $('#selected_day_field_end');
    selected_day_field_end.val(new Date().toISOString().substr(0, 10));

    const load_day_btn = $('#load_day_btn');
    load_day_btn.on('click', function () {
      getPlateDetectionData();
    });

    const licence_plate_flex_viewer = $('#licence_plate_flex_viewer');
    licence_plate_flex_viewer.on('click', 'img', function () {
      const id = $(this).attr('id');
      console.log(id);
      getObjectDetectionImage(id);
    });


    // getPlateDetectionData();

    // License plate detection data, images and plate strings
    function getPlateDetectionData() {
      appendLoadingIndicator(licence_plate_flex_viewer);
      $.ajax({
        url: apiUrl + 'get/license/plate/detections',
        type: 'POST',
        data: {
          selectedDate: null,
          selectedDateStart: selected_day_field_start.val(),
          selectedDateEnd: selected_day_field_end.val(),
        }
      }).done(function (data) {
        licence_plate_flex_viewer.empty();
        if (data.licensePlates.length > 0) {
          data.licensePlates.forEach(licensePlate => {
            licence_plate_flex_viewer.append(
              '<div class="container mb-2">' +
              '  <div class="row">' +
              '    <div class="col mr-0 ml-0 pr-0 pl-0">' +
              '     <p class="lead text-center" style="font-weight: bold; background-color: #f4f4f4; width: 100%; height: 100%">'
              + licensePlate.detectionResult +
              '<br><a style="color: darkgreen; font-size: 12px;">' + licensePlate.detectionCorrected + '</a></p>' +
              '    </div>' +
              '    <div class="col mr-0 ml-0 pr-0 pl-0">' +
              '     <p class="lead text-center" style="font-weight: bold; background-color: #f4f4f4; width: 100%; height: 100%">'
              + licensePlate.ownerName + '</p>' +
              '    </div>\n' +
              '    <div class="col mr-0 ml-0 pr-0 pl-0">' +
              '     <img id="' + licensePlate.objectDetectionFileName + '" title="' + licensePlate.title + '" style="cursor: zoom-in; width: 120px; height: 80px; max-width: 120px; max-height: 120px;" src="' + licensePlate.image + '">' +
              '    </div>' +
              '  </div>' +
              '</div>' +
              '<hr>'
            );
            wheelzoom(document.getElementById(licensePlate.objectDetectionFileName));
          });
        }
      }).fail(function (error) {
        licence_plate_flex_viewer.empty();
      });
    }


    function appendLoadingIndicator(jqueryElement) {
      jqueryElement.append('<div id="loading_indicator_place_holder" style="width: 100%"></div>');
      const loading_indicator_place_holder = $('#loading_indicator_place_holder');
      loading_indicator_place_holder.append('<div id="label_image_loading_indicator" ' +
        'style="width: 100%" class="text-center">' +
        '<div class="spinner-border" role="status">' +
        '<span class="sr-only">Loading...</span>' +
        '</div>' +
        '</div>');
    }



    /**
     * Load object_detection image for given file name
     * @param object_detection_image_file_name
     */
    function getObjectDetectionImage(object_detection_image_file_name) {
      $.ajax({
        url: apiUrl + 'get/object/detection/image',
        type: 'POST',
        data: {
          objectDetectionImageFileName: object_detection_image_file_name
        },
      }).done(function (data) {
        generic_image_modal.modal('show');
        generic_modal_title.text(object_detection_image_file_name);
        generic_modal_description.text('');
        generic_modal_image.attr("src", data.data);
      }).fail(function (error) {
        alert(error);
      });
    }
  });


</script>

</body>
</html>
